<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RBAC Application Testing Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        
        h1:first-child {
            margin-top: 0;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 20px;
        }
        
        h4 {
            color: #7f8c8d;
            margin-top: 15px;
        }
        
        code {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 3px;
            padding: 2px 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
        }
        
        pre code {
            background-color: transparent;
            border: none;
            padding: 0;
        }
        
        blockquote {
            border-left: 4px solid #3498db;
            margin: 20px 0;
            padding: 10px 20px;
            background-color: #f8f9fa;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 5px 0;
        }
        
        a {
            color: #3498db;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .header h1 {
            color: #2c3e50;
            margin: 0;
            border: none;
        }
        
        .header p {
            color: #7f8c8d;
            margin: 10px 0 0 0;
        }
        
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
        }
        
        .print-button:hover {
            background-color: #2980b9;
        }
        
        @media print {
            .print-button {
                display: none;
            }
            
            body {
                background-color: white;
            }
            
            .container {
                box-shadow: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">üñ®Ô∏è Print PDF</button>
    
    <div class="container">
        <div class="header">
            <h1>RBAC Application Testing Guide</h1>
            <p>RBAC Application Documentation</p>
        </div>
        
        <p><h1>RBAC Application Testing Guide</h1></p><p><h2>Overview</h2></p><p>This guide provides comprehensive testing strategies, test cases, and implementation examples for the RBAC application, covering unit tests, integration tests, end-to-end tests, and security testing.</p><p><h2>Testing Strategy</h2></p><p><h3>Testing Pyramid</h3><br><pre><code><br>                    /\<br>                   /  \<br>                  / E2E \     (Few, High-level)<br>                 /______\<br>                /        \<br>               /Integration\  (Some, Medium-level)<br>              /____________\<br>             /              \<br>            /   Unit Tests   \  (Many, Low-level)<br>           /__________________\<br></code></pre></p><p><h3>Test Types</h3><br><ul><li><strong>Unit Tests</strong>: Individual components and functions</li><br><li><strong>Integration Tests</strong>: API endpoints and database interactions</li><br><li><strong>End-to-End Tests</strong>: Complete user workflows</li><br><li><strong>Security Tests</strong>: Authentication and authorization</li><br><li><strong>Performance Tests</strong>: Load and stress testing</li></ul></p><p><h2>Frontend Testing</h2></p><p><h3>1. Unit Testing with Jest and React Testing Library</h3></p><p>#### Setup<br><pre><code>bash<br>cd frontend<br>npm install --save-dev @testing-library/react @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom<br></code></pre></p><p>#### Test Configuration<br>Create <code>frontend/src/setupTests.js</code>:<br><pre><code>javascript<br>import '@testing-library/jest-dom';<br></code></pre></p><p>Create <code>frontend/jest.config.js</code>:<br><pre><code>javascript<br>module.exports = {<br>  testEnvironment: 'jsdom',<br>  setupFilesAfterEnv: ['<rootDir>/src/setupTests.js'],<br>  moduleNameMapping: {<br>    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',<br>  },<br>  collectCoverageFrom: [<br>    'src/<em></em>/*.{js,jsx}',<br>    '!src/index.js',<br>    '!src/reportWebVitals.js',<br>  ],<br>};<br></code></pre></p><p>#### Component Tests</p><p><strong>Login Component Test:</strong><br><pre><code>javascript<br>// frontend/src/pages/__tests__/Login.test.js<br>import React from 'react';<br>import { render, screen, fireEvent, waitFor } from '@testing-library/react';<br>import userEvent from '@testing-library/user-event';<br>import { Provider } from 'react-redux';<br>import { BrowserRouter } from 'react-router-dom';<br>import { configureStore } from '@reduxjs/toolkit';<br>import Login from '../Login';<br>import authSlice from '../../store/slices/authSlice';</p><p>const createTestStore = (initialState = {}) => {<br>  return configureStore({<br>    reducer: {<br>      auth: authSlice,<br>    },<br>    preloadedState: {<br>      auth: {<br>        loading: false,<br>        error: null,<br>        isAuthenticated: false,<br>        user: null,<br>        ...initialState,<br>      },<br>    },<br>  });<br>};</p><p>const renderWithProviders = (component, { store = createTestStore() } = {}) => {<br>  return render(<br>    <Provider store={store}><br>      <BrowserRouter><br>        {component}<br>      </BrowserRouter><br>    </Provider><br>  );<br>};</p><p>describe('Login Component', () => {<br>  test('renders login form', () => {<br>    renderWithProviders(<Login />);<br>    <br>    expect(screen.getByLabelText(/email address/i)).toBeInTheDocument();<br>    expect(screen.getByLabelText(/password/i)).toBeInTheDocument();<br>    expect(screen.getByRole('button', { name: /sign in/i })).toBeInTheDocument();<br>  });</p><p>  test('displays demo accounts information', () => {<br>    renderWithProviders(<Login />);<br>    <br>    expect(screen.getByText(/demo accounts/i)).toBeInTheDocument();<br>    expect(screen.getByText(/admin@example.com/i)).toBeInTheDocument();<br>  });</p><p>  test('shows validation errors for empty fields', async () => {<br>    const user = userEvent.setup();<br>    renderWithProviders(<Login />);<br>    <br>    const submitButton = screen.getByRole('button', { name: /sign in/i });<br>    await user.click(submitButton);<br>    <br>    expect(screen.getByText(/email is required/i)).toBeInTheDocument();<br>    expect(screen.getByText(/password is required/i)).toBeInTheDocument();<br>  });</p><p>  test('submits form with valid credentials', async () => {<br>    const user = userEvent.setup();<br>    const store = createTestStore();<br>    <br>    renderWithProviders(<Login />, { store });<br>    <br>    const emailInput = screen.getByLabelText(/email address/i);<br>    const passwordInput = screen.getByLabelText(/password/i);<br>    const submitButton = screen.getByRole('button', { name: /sign in/i });<br>    <br>    await user.type(emailInput, 'admin@example.com');<br>    await user.type(passwordInput, 'Admin123!');<br>    await user.click(submitButton);<br>    <br>    // Verify that login action was dispatched<br>    const actions = store.getState();<br>    expect(actions.auth.loading).toBe(true);<br>  });<br>});<br></code></pre></p><p><strong>ProtectedRoute Component Test:</strong><br><pre><code>javascript<br>// frontend/src/components/__tests__/ProtectedRoute.test.js<br>import React from 'react';<br>import { render } from '@testing-library/react';<br>import { Provider } from 'react-redux';<br>import { MemoryRouter } from 'react-router-dom';<br>import { configureStore } from '@reduxjs/toolkit';<br>import ProtectedRoute from '../ProtectedRoute';<br>import authSlice from '../../store/slices/authSlice';</p><p>const createTestStore = (initialState = {}) => {<br>  return configureStore({<br>    reducer: {<br>      auth: authSlice,<br>    },<br>    preloadedState: {<br>      auth: {<br>        loading: false,<br>        error: null,<br>        isAuthenticated: false,<br>        user: null,<br>        ...initialState,<br>      },<br>    },<br>  });<br>};</p><p>const TestComponent = () => <div>Protected Content</div>;</p><p>describe('ProtectedRoute Component', () => {<br>  test('redirects to login when not authenticated', () => {<br>    const store = createTestStore();<br>    <br>    render(<br>      <Provider store={store}><br>        <MemoryRouter><br>          <ProtectedRoute><br>            <TestComponent /><br>          </ProtectedRoute><br>        </MemoryRouter><br>      </Provider><br>    );<br>    <br>    // Should redirect to login, so protected content should not be visible<br>    expect(screen.queryByText('Protected Content')).not.toBeInTheDocument();<br>  });</p><p>  test('renders children when authenticated', () => {<br>    const store = createTestStore({<br>      isAuthenticated: true,<br>      user: {<br>        _id: '1',<br>        email: 'test@example.com',<br>        role: {<br>          permissions: ['dashboard:read']<br>        }<br>      }<br>    });<br>    <br>    render(<br>      <Provider store={store}><br>        <MemoryRouter><br>          <ProtectedRoute><br>            <TestComponent /><br>          </ProtectedRoute><br>        </MemoryRouter><br>      </Provider><br>    );<br>    <br>    expect(screen.getByText('Protected Content')).toBeInTheDocument();<br>  });</p><p>  test('redirects to unauthorized when permission denied', () => {<br>    const store = createTestStore({<br>      isAuthenticated: true,<br>      user: {<br>        _id: '1',<br>        email: 'test@example.com',<br>        role: {<br>          permissions: ['user:read']<br>        }<br>      }<br>    });<br>    <br>    render(<br>      <Provider store={store}><br>        <MemoryRouter><br>          <ProtectedRoute requiredPermission="admin:access"><br>            <TestComponent /><br>          </ProtectedRoute><br>        </MemoryRouter><br>      </Provider><br>    );<br>    <br>    expect(screen.queryByText('Protected Content')).not.toBeInTheDocument();<br>  });<br>});<br></code></pre></p><p>#### Redux Store Tests</p><p><strong>Auth Slice Test:</strong><br><pre><code>javascript<br>// frontend/src/store/slices/__tests__/authSlice.test.js<br>import authSlice, { login, logout, getMe } from '../authSlice';</p><p>describe('Auth Slice', () => {<br>  const initialState = {<br>    user: null,<br>    token: null,<br>    refreshToken: null,<br>    isAuthenticated: false,<br>    loading: false,<br>    error: null,<br>  };</p><p>  test('should return initial state', () => {<br>    expect(authSlice(undefined, {})).toEqual(initialState);<br>  });</p><p>  test('should handle login pending', () => {<br>    const action = { type: login.pending.type };<br>    const state = authSlice(initialState, action);<br>    <br>    expect(state.loading).toBe(true);<br>    expect(state.error).toBe(null);<br>  });</p><p>  test('should handle login fulfilled', () => {<br>    const mockUser = {<br>      _id: '1',<br>      email: 'test@example.com',<br>      role: { name: 'admin' }<br>    };<br>    const mockToken = 'mock-token';<br>    <br>    const action = {<br>      type: login.fulfilled.type,<br>      payload: {<br>        user: mockUser,<br>        token: mockToken,<br>        refreshToken: 'mock-refresh-token'<br>      }<br>    };<br>    <br>    const state = authSlice(initialState, action);<br>    <br>    expect(state.user).toEqual(mockUser);<br>    expect(state.token).toBe(mockToken);<br>    expect(state.isAuthenticated).toBe(true);<br>    expect(state.loading).toBe(false);<br>  });</p><p>  test('should handle login rejected', () => {<br>    const errorMessage = 'Invalid credentials';<br>    const action = {<br>      type: login.rejected.type,<br>      payload: errorMessage<br>    };<br>    <br>    const state = authSlice(initialState, action);<br>    <br>    expect(state.error).toBe(errorMessage);<br>    expect(state.loading).toBe(false);<br>    expect(state.isAuthenticated).toBe(false);<br>  });<br>});<br></code></pre></p><p><h3>2. Integration Testing</h3></p><p><strong>API Service Tests:</strong><br><pre><code>javascript<br>// frontend/src/services/__tests__/authService.test.js<br>import { authService } from '../authService';<br>import api from '../api';</p><p>// Mock the API module<br>jest.mock('../api');</p><p>describe('Auth Service', () => {<br>  beforeEach(() => {<br>    jest.clearAllMocks();<br>  });</p><p>  test('login should call API with correct parameters', async () => {<br>    const mockResponse = {<br>      data: {<br>        user: { _id: '1', email: 'test@example.com' },<br>        token: 'mock-token'<br>      }<br>    };<br>    <br>    api.post.mockResolvedValue(mockResponse);<br>    <br>    const credentials = {<br>      email: 'test@example.com',<br>      password: 'password123'<br>    };<br>    <br>    const result = await authService.login(credentials);<br>    <br>    expect(api.post).toHaveBeenCalledWith('/auth/login', credentials);<br>    expect(result).toEqual(mockResponse.data);<br>  });</p><p>  test('login should handle API errors', async () => {<br>    const mockError = new Error('Network error');<br>    api.post.mockRejectedValue(mockError);<br>    <br>    const credentials = {<br>      email: 'test@example.com',<br>      password: 'wrongpassword'<br>    };<br>    <br>    await expect(authService.login(credentials)).rejects.toThrow('Network error');<br>  });<br>});<br></code></pre></p><p><h2>Backend Testing</h2></p><p><h3>1. Unit Testing with Jest</h3></p><p>#### Setup<br><pre><code>bash<br>cd backend<br>npm install --save-dev jest supertest mongodb-memory-server<br></code></pre></p><p>#### Test Configuration<br>Create <code>backend/jest.config.js</code>:<br><pre><code>javascript<br>module.exports = {<br>  testEnvironment: 'node',<br>  collectCoverageFrom: [<br>    'src/<em></em>/*.js',<br>    '!src/index.js',<br>  ],<br>  testMatch: [<br>    '<strong>/__tests__/</strong>/*.js',<br>    '<em></em>/?(*.)+(spec|test).js'<br>  ],<br>  setupFilesAfterEnv: ['<rootDir>/src/__tests__/setup.js']<br>};<br></code></pre></p><p>#### Controller Tests</p><p><strong>Auth Controller Test:</strong><br><pre><code>javascript<br>// backend/src/controllers/__tests__/authController.test.js<br>const request = require('supertest');<br>const mongoose = require('mongoose');<br>const { MongoMemoryServer } = require('mongodb-memory-server');<br>const app = require('../../index');<br>const User = require('../../models/User');<br>const Role = require('../../models/Role');</p><p>let mongoServer;</p><p>beforeAll(async () => {<br>  mongoServer = await MongoMemoryServer.create();<br>  const mongoUri = mongoServer.getUri();<br>  await mongoose.connect(mongoUri);<br>});</p><p>afterAll(async () => {<br>  await mongoose.disconnect();<br>  await mongoServer.stop();<br>});</p><p>beforeEach(async () => {<br>  await User.deleteMany({});<br>  await Role.deleteMany({});<br>});</p><p>describe('Auth Controller', () => {<br>  describe('POST /api/auth/login', () => {<br>    test('should login with valid credentials', async () => {<br>      // Create test role<br>      const role = await Role.create({<br>        name: 'test-role',<br>        description: 'Test role',<br>        permissions: ['user:read']<br>      });</p><p>      // Create test user<br>      const user = await User.create({<br>        firstName: 'Test',<br>        lastName: 'User',<br>        email: 'test@example.com',<br>        password: 'password123',<br>        role: role._id<br>      });</p><p>      const response = await request(app)<br>        .post('/api/auth/login')<br>        .send({<br>          email: 'test@example.com',<br>          password: 'password123'<br>        });</p><p>      expect(response.status).toBe(200);<br>      expect(response.body.success).toBe(true);<br>      expect(response.body.data.user.email).toBe('test@example.com');<br>      expect(response.body.data.token).toBeDefined();<br>    });</p><p>    test('should reject invalid credentials', async () => {<br>      const response = await request(app)<br>        .post('/api/auth/login')<br>        .send({<br>          email: 'test@example.com',<br>          password: 'wrongpassword'<br>        });</p><p>      expect(response.status).toBe(401);<br>      expect(response.body.success).toBe(false);<br>      expect(response.body.message).toBe('Invalid credentials');<br>    });</p><p>    test('should require email and password', async () => {<br>      const response = await request(app)<br>        .post('/api/auth/login')<br>        .send({});</p><p>      expect(response.status).toBe(400);<br>    });<br>  });</p><p>  describe('POST /api/auth/register', () => {<br>    test('should register new user', async () => {<br>      const role = await Role.create({<br>        name: 'viewer',<br>        description: 'Viewer role',<br>        permissions: ['user:read']<br>      });</p><p>      const userData = {<br>        firstName: 'New',<br>        lastName: 'User',<br>        email: 'newuser@example.com',<br>        password: 'password123',<br>        role: role._id<br>      };</p><p>      const response = await request(app)<br>        .post('/api/auth/register')<br>        .send(userData);</p><p>      expect(response.status).toBe(201);<br>      expect(response.body.success).toBe(true);<br>      expect(response.body.data.user.email).toBe('newuser@example.com');<br>    });</p><p>    test('should reject duplicate email', async () => {<br>      const role = await Role.create({<br>        name: 'viewer',<br>        description: 'Viewer role',<br>        permissions: ['user:read']<br>      });</p><p>      await User.create({<br>        firstName: 'Existing',<br>        lastName: 'User',<br>        email: 'existing@example.com',<br>        password: 'password123',<br>        role: role._id<br>      });</p><p>      const response = await request(app)<br>        .post('/api/auth/register')<br>        .send({<br>          firstName: 'New',<br>          lastName: 'User',<br>          email: 'existing@example.com',<br>          password: 'password123',<br>          role: role._id<br>        });</p><p>      expect(response.status).toBe(400);<br>      expect(response.body.message).toBe('User already exists with this email');<br>    });<br>  });<br>});<br></code></pre></p><p><strong>User Controller Test:</strong><br><pre><code>javascript<br>// backend/src/controllers/__tests__/userController.test.js<br>const request = require('supertest');<br>const mongoose = require('mongoose');<br>const { MongoMemoryServer } = require('mongodb-memory-server');<br>const app = require('../../index');<br>const User = require('../../models/User');<br>const Role = require('../../models/Role');<br>const { generateToken } = require('../../utils/jwt');</p><p>let mongoServer;<br>let authToken;<br>let testRole;</p><p>beforeAll(async () => {<br>  mongoServer = await MongoMemoryServer.create();<br>  const mongoUri = mongoServer.getUri();<br>  await mongoose.connect(mongoUri);<br>});</p><p>afterAll(async () => {<br>  await mongoose.disconnect();<br>  await mongoServer.stop();<br>});</p><p>beforeEach(async () => {<br>  await User.deleteMany({});<br>  await Role.deleteMany({});</p><p>  // Create test role<br>  testRole = await Role.create({<br>    name: 'admin',<br>    description: 'Admin role',<br>    permissions: ['user:read', 'user:write', 'user:delete']<br>  });</p><p>  // Create test user<br>  const testUser = await User.create({<br>    firstName: 'Admin',<br>    lastName: 'User',<br>    email: 'admin@example.com',<br>    password: 'password123',<br>    role: testRole._id<br>  });</p><p>  // Generate auth token<br>  authToken = generateToken({ id: testUser._id });<br>});</p><p>describe('User Controller', () => {<br>  describe('GET /api/users', () => {<br>    test('should get all users with authentication', async () => {<br>      // Create additional test users<br>      await User.create({<br>        firstName: 'User1',<br>        lastName: 'Test',<br>        email: 'user1@example.com',<br>        password: 'password123',<br>        role: testRole._id<br>      });</p><p>      const response = await request(app)<br>        .get('/api/users')<br>        .set('Authorization', <code>Bearer ${authToken}</code>);</p><p>      expect(response.status).toBe(200);<br>      expect(response.body.success).toBe(true);<br>      expect(response.body.data.users).toHaveLength(2);<br>    });</p><p>    test('should require authentication', async () => {<br>      const response = await request(app)<br>        .get('/api/users');</p><p>      expect(response.status).toBe(401);<br>    });</p><p>    test('should support pagination', async () => {<br>      const response = await request(app)<br>        .get('/api/users?page=1&limit=1')<br>        .set('Authorization', <code>Bearer ${authToken}</code>);</p><p>      expect(response.status).toBe(200);<br>      expect(response.body.data.pagination.currentPage).toBe(1);<br>      expect(response.body.data.pagination.totalPages).toBe(1);<br>    });<br>  });</p><p>  describe('POST /api/users', () => {<br>    test('should create new user with valid data', async () => {<br>      const userData = {<br>        firstName: 'New',<br>        lastName: 'User',<br>        email: 'newuser@example.com',<br>        password: 'password123',<br>        role: testRole._id<br>      };</p><p>      const response = await request(app)<br>        .post('/api/users')<br>        .set('Authorization', <code>Bearer ${authToken}</code>)<br>        .send(userData);</p><p>      expect(response.status).toBe(201);<br>      expect(response.body.success).toBe(true);<br>      expect(response.body.data.user.email).toBe('newuser@example.com');<br>    });</p><p>    test('should require user:write permission', async () => {<br>      // Create user with limited permissions<br>      const limitedRole = await Role.create({<br>        name: 'viewer',<br>        description: 'Viewer role',<br>        permissions: ['user:read']<br>      });</p><p>      const limitedUser = await User.create({<br>        firstName: 'Limited',<br>        lastName: 'User',<br>        email: 'limited@example.com',<br>        password: 'password123',<br>        role: limitedRole._id<br>      });</p><p>      const limitedToken = generateToken({ id: limitedUser._id });</p><p>      const response = await request(app)<br>        .post('/api/users')<br>        .set('Authorization', <code>Bearer ${limitedToken}</code>)<br>        .send({<br>          firstName: 'New',<br>          lastName: 'User',<br>          email: 'newuser@example.com',<br>          password: 'password123',<br>          role: testRole._id<br>        });</p><p>      expect(response.status).toBe(403);<br>    });<br>  });<br>});<br></code></pre></p><p><h3>2. Model Tests</h3></p><p><strong>User Model Test:</strong><br><pre><code>javascript<br>// backend/src/models/__tests__/User.test.js<br>const mongoose = require('mongoose');<br>const { MongoMemoryServer } = require('mongodb-memory-server');<br>const User = require('../User');<br>const Role = require('../Role');</p><p>let mongoServer;</p><p>beforeAll(async () => {<br>  mongoServer = await MongoMemoryServer.create();<br>  const mongoUri = mongoServer.getUri();<br>  await mongoose.connect(mongoUri);<br>});</p><p>afterAll(async () => {<br>  await mongoose.disconnect();<br>  await mongoServer.stop();<br>});</p><p>beforeEach(async () => {<br>  await User.deleteMany({});<br>  await Role.deleteMany({});<br>});</p><p>describe('User Model', () => {<br>  test('should create user with valid data', async () => {<br>    const role = await Role.create({<br>      name: 'test-role',<br>      description: 'Test role',<br>      permissions: ['user:read']<br>    });</p><p>    const userData = {<br>      firstName: 'Test',<br>      lastName: 'User',<br>      email: 'test@example.com',<br>      password: 'password123',<br>      role: role._id<br>    };</p><p>    const user = await User.create(userData);</p><p>    expect(user.firstName).toBe('Test');<br>    expect(user.lastName).toBe('User');<br>    expect(user.email).toBe('test@example.com');<br>    expect(user.password).not.toBe('password123'); // Should be hashed<br>    expect(user.role.toString()).toBe(role._id.toString());<br>  });</p><p>  test('should hash password before saving', async () => {<br>    const role = await Role.create({<br>      name: 'test-role',<br>      description: 'Test role',<br>      permissions: ['user:read']<br>    });</p><p>    const user = new User({<br>      firstName: 'Test',<br>      lastName: 'User',<br>      email: 'test@example.com',<br>      password: 'password123',<br>      role: role._id<br>    });</p><p>    await user.save();</p><p>    expect(user.password).not.toBe('password123');<br>    expect(user.password).toMatch(/^\$2[aby]\$\d+\$/); // bcrypt hash pattern<br>  });</p><p>  test('should compare password correctly', async () => {<br>    const role = await Role.create({<br>      name: 'test-role',<br>      description: 'Test role',<br>      permissions: ['user:read']<br>    });</p><p>    const user = await User.create({<br>      firstName: 'Test',<br>      lastName: 'User',<br>      email: 'test@example.com',<br>      password: 'password123',<br>      role: role._id<br>    });</p><p>    const isValid = await user.comparePassword('password123');<br>    const isInvalid = await user.comparePassword('wrongpassword');</p><p>    expect(isValid).toBe(true);<br>    expect(isInvalid).toBe(false);<br>  });</p><p>  test('should require unique email', async () => {<br>    const role = await Role.create({<br>      name: 'test-role',<br>      description: 'Test role',<br>      permissions: ['user:read']<br>    });</p><p>    await User.create({<br>      firstName: 'Test',<br>      lastName: 'User',<br>      email: 'test@example.com',<br>      password: 'password123',<br>      role: role._id<br>    });</p><p>    await expect(User.create({<br>      firstName: 'Another',<br>      lastName: 'User',<br>      email: 'test@example.com',<br>      password: 'password123',<br>      role: role._id<br>    })).rejects.toThrow();<br>  });<br>});<br></code></pre></p><p><h2>End-to-End Testing</h2></p><p><h3>1. Cypress Testing</h3></p><p>#### Setup<br><pre><code>bash<br>cd frontend<br>npm install --save-dev cypress<br>npx cypress open<br></code></pre></p><p>#### E2E Test Examples</p><p><strong>Authentication Flow Test:</strong><br><pre><code>javascript<br>// cypress/e2e/auth.cy.js<br>describe('Authentication Flow', () => {<br>  beforeEach(() => {<br>    cy.visit('/login');<br>  });</p><p>  it('should login with valid credentials', () => {<br>    cy.get('input[name="email"]').type('admin@example.com');<br>    cy.get('input[name="password"]').type('Admin123!');<br>    cy.get('button[type="submit"]').click();</p><p>    cy.url().should('include', '/dashboard');<br>    cy.get('[data-testid="user-menu"]').should('contain', 'Admin User');<br>  });</p><p>  it('should show error for invalid credentials', () => {<br>    cy.get('input[name="email"]').type('admin@example.com');<br>    cy.get('input[name="password"]').type('wrongpassword');<br>    cy.get('button[type="submit"]').click();</p><p>    cy.get('[data-testid="error-message"]').should('be.visible');<br>    cy.url().should('include', '/login');<br>  });</p><p>  it('should logout successfully', () => {<br>    // Login first<br>    cy.get('input[name="email"]').type('admin@example.com');<br>    cy.get('input[name="password"]').type('Admin123!');<br>    cy.get('button[type="submit"]').click();</p><p>    // Logout<br>    cy.get('[data-testid="user-menu"]').click();<br>    cy.get('[data-testid="logout-button"]').click();</p><p>    cy.url().should('include', '/login');<br>  });<br>});<br></code></pre></p><p><strong>User Management Test:</strong><br><pre><code>javascript<br>// cypress/e2e/user-management.cy.js<br>describe('User Management', () => {<br>  beforeEach(() => {<br>    // Login as admin<br>    cy.login('admin@example.com', 'Admin123!');<br>    cy.visit('/users');<br>  });</p><p>  it('should display users list', () => {<br>    cy.get('[data-testid="users-table"]').should('be.visible');<br>    cy.get('[data-testid="user-row"]').should('have.length.at.least', 1);<br>  });</p><p>  it('should create new user', () => {<br>    cy.get('[data-testid="create-user-button"]').click();<br>    <br>    cy.get('input[name="firstName"]').type('New');<br>    cy.get('input[name="lastName"]').type('User');<br>    cy.get('input[name="email"]').type('newuser@example.com');<br>    cy.get('input[name="password"]').type('Password123!');<br>    cy.get('select[name="role"]').select('editor');<br>    <br>    cy.get('button[type="submit"]').click();<br>    <br>    cy.get('[data-testid="success-message"]').should('be.visible');<br>    cy.get('[data-testid="user-row"]').should('contain', 'newuser@example.com');<br>  });</p><p>  it('should edit existing user', () => {<br>    cy.get('[data-testid="edit-user-button"]').first().click();<br>    <br>    cy.get('input[name="firstName"]').clear().type('Updated');<br>    cy.get('button[type="submit"]').click();<br>    <br>    cy.get('[data-testid="success-message"]').should('be.visible');<br>    cy.get('[data-testid="user-row"]').should('contain', 'Updated');<br>  });</p><p>  it('should delete user with confirmation', () => {<br>    cy.get('[data-testid="delete-user-button"]').first().click();<br>    cy.get('[data-testid="confirm-delete"]').click();<br>    <br>    cy.get('[data-testid="success-message"]').should('be.visible');<br>  });<br>});<br></code></pre></p><p><strong>Permission Testing:</strong><br><pre><code>javascript<br>// cypress/e2e/permissions.cy.js<br>describe('Permission-based Access Control', () => {<br>  it('should restrict viewer from accessing user management', () => {<br>    cy.login('viewer@example.com', 'Viewer123!');<br>    <br>    // Try to access user management<br>    cy.visit('/users');<br>    <br>    // Should be redirected to unauthorized page<br>    cy.url().should('include', '/unauthorized');<br>  });</p><p>  it('should allow admin to access all features', () => {<br>    cy.login('admin@example.com', 'Admin123!');<br>    <br>    // Should be able to access all pages<br>    cy.visit('/dashboard');<br>    cy.url().should('include', '/dashboard');<br>    <br>    cy.visit('/users');<br>    cy.url().should('include', '/users');<br>    <br>    cy.visit('/roles');<br>    cy.url().should('include', '/roles');<br>    <br>    cy.visit('/admin');<br>    cy.url().should('include', '/admin');<br>  });</p><p>  it('should hide unauthorized buttons for limited users', () => {<br>    cy.login('viewer@example.com', 'Viewer123!');<br>    cy.visit('/dashboard');<br>    <br>    // Should not see create/edit/delete buttons<br>    cy.get('[data-testid="create-user-button"]').should('not.exist');<br>    cy.get('[data-testid="edit-user-button"]').should('not.exist');<br>    cy.get('[data-testid="delete-user-button"]').should('not.exist');<br>  });<br>});<br></code></pre></p><p><h2>Security Testing</h2></p><p><h3>1. Authentication Security Tests</h3></p><p><pre><code>javascript<br>// backend/src/__tests__/security.test.js<br>const request = require('supertest');<br>const mongoose = require('mongoose');<br>const { MongoMemoryServer } = require('mongodb-memory-server');<br>const app = require('../index');</p><p>describe('Security Tests', () => {<br>  test('should reject requests without authentication', async () => {<br>    const response = await request(app)<br>      .get('/api/users');</p><p>    expect(response.status).toBe(401);<br>  });</p><p>  test('should reject requests with invalid token', async () => {<br>    const response = await request(app)<br>      .get('/api/users')<br>      .set('Authorization', 'Bearer invalid-token');</p><p>    expect(response.status).toBe(401);<br>  });</p><p>  test('should implement rate limiting', async () => {<br>    const promises = [];<br>    <br>    // Make multiple requests quickly<br>    for (let i = 0; i < 10; i++) {<br>      promises.push(<br>        request(app)<br>          .post('/api/auth/login')<br>          .send({<br>            email: 'test@example.com',<br>            password: 'wrongpassword'<br>          })<br>      );<br>    }</p><p>    const responses = await Promise.all(promises);<br>    <br>    // Should eventually get rate limited<br>    const rateLimited = responses.some(res => res.status === 429);<br>    expect(rateLimited).toBe(true);<br>  });</p><p>  test('should validate input data', async () => {<br>    const response = await request(app)<br>      .post('/api/auth/register')<br>      .send({<br>        email: 'invalid-email',<br>        password: '123' // Too short<br>      });</p><p>    expect(response.status).toBe(400);<br>    expect(response.body.errors).toBeDefined();<br>  });<br>});<br></code></pre></p><p><h3>2. Authorization Security Tests</h3></p><p><pre><code>javascript<br>describe('Authorization Tests', () => {<br>  test('should prevent privilege escalation', async () => {<br>    // Create viewer user<br>    const viewerRole = await Role.create({<br>      name: 'viewer',<br>      description: 'Viewer role',<br>      permissions: ['user:read']<br>    });</p><p>    const viewer = await User.create({<br>      firstName: 'Viewer',<br>      lastName: 'User',<br>      email: 'viewer@example.com',<br>      password: 'password123',<br>      role: viewerRole._id<br>    });</p><p>    const viewerToken = generateToken({ id: viewer._id });</p><p>    // Try to create user (should fail)<br>    const response = await request(app)<br>      .post('/api/users')<br>      .set('Authorization', <code>Bearer ${viewerToken}</code>)<br>      .send({<br>        firstName: 'New',<br>        lastName: 'User',<br>        email: 'newuser@example.com',<br>        password: 'password123',<br>        role: viewerRole._id<br>      });</p><p>    expect(response.status).toBe(403);<br>  });</p><p>  test('should prevent access to admin functions', async () => {<br>    const viewerRole = await Role.create({<br>      name: 'viewer',<br>      description: 'Viewer role',<br>      permissions: ['user:read']<br>    });</p><p>    const viewer = await User.create({<br>      firstName: 'Viewer',<br>      lastName: 'User',<br>      email: 'viewer@example.com',<br>      password: 'password123',<br>      role: viewerRole._id<br>    });</p><p>    const viewerToken = generateToken({ id: viewer._id });</p><p>    // Try to delete user (should fail)<br>    const response = await request(app)<br>      .delete('/api/users/some-user-id')<br>      .set('Authorization', <code>Bearer ${viewerToken}</code>);</p><p>    expect(response.status).toBe(403);<br>  });<br>});<br></code></pre></p><p><h2>Performance Testing</h2></p><p><h3>1. Load Testing with Artillery</h3></p><p>#### Setup<br><pre><code>bash<br>npm install -g artillery<br></code></pre></p><p>#### Load Test Configuration<br><pre><code>yaml<br><h1>artillery-config.yml</h1><br>config:<br>  target: 'http://localhost:5001'<br>  phases:<br>    - duration: 60<br>      arrivalRate: 10<br>  defaults:<br>    headers:<br>      Authorization: 'Bearer YOUR_JWT_TOKEN'</p><p>scenarios:<br>  - name: "User Management API"<br>    weight: 100<br>    flow:<br>      - get:<br>          url: "/api/users"<br>      - post:<br>          url: "/api/users"<br>          json:<br>            firstName: "Load"<br>            lastName: "Test"<br>            email: "loadtest{{ $randomInt() }}@example.com"<br>            password: "password123"<br>            role: "ROLE_ID"<br></code></pre></p><p>#### Run Load Test<br><pre><code>bash<br>artillery run artillery-config.yml<br></code></pre></p><p><h3>2. Stress Testing</h3></p><p><pre><code>yaml<br><h1>stress-test.yml</h1><br>config:<br>  target: 'http://localhost:5001'<br>  phases:<br>    - duration: 30<br>      arrivalRate: 1<br>    - duration: 60<br>      arrivalRate: 50<br>    - duration: 30<br>      arrivalRate: 100<br></code></pre></p><p><h2>Test Automation</h2></p><p><h3>1. GitHub Actions CI/CD</h3></p><p>Create <code>.github/workflows/test.yml</code>:<br><pre><code>yaml<br>name: Test Suite</p><p>on:<br>  push:<br>    branches: [ main, develop ]<br>  pull_request:<br>    branches: [ main ]</p><p>jobs:<br>  frontend-tests:<br>    runs-on: ubuntu-latest<br>    steps:<br>      - uses: actions/checkout@v3<br>      <br>      - name: Setup Node.js<br>        uses: actions/setup-node@v3<br>        with:<br>          node-version: '18'<br>          cache: 'npm'<br>          cache-dependency-path: frontend/package-lock.json<br>      <br>      - name: Install dependencies<br>        run: |<br>          cd frontend<br>          npm ci<br>      <br>      - name: Run tests<br>        run: |<br>          cd frontend<br>          npm test -- --coverage --watchAll=false<br>      <br>      - name: Upload coverage<br>        uses: codecov/codecov-action@v3<br>        with:<br>          file: ./frontend/coverage/lcov.info</p><p>  backend-tests:<br>    runs-on: ubuntu-latest<br>    services:<br>      mongodb:<br>        image: mongo:6.0<br>        ports:<br>          - 27017:27017<br>    <br>    steps:<br>      - uses: actions/checkout@v3<br>      <br>      - name: Setup Node.js<br>        uses: actions/setup-node@v3<br>        with:<br>          node-version: '18'<br>          cache: 'npm'<br>          cache-dependency-path: backend/package-lock.json<br>      <br>      - name: Install dependencies<br>        run: |<br>          cd backend<br>          npm ci<br>      <br>      - name: Run tests<br>        run: |<br>          cd backend<br>          npm test<br>        env:<br>          MONGODB_URI: mongodb://localhost:27017/rbac-test</p><p>  e2e-tests:<br>    runs-on: ubuntu-latest<br>    steps:<br>      - uses: actions/checkout@v3<br>      <br>      - name: Setup Node.js<br>        uses: actions/setup-node@v3<br>        with:<br>          node-version: '18'<br>      <br>      - name: Install dependencies<br>        run: |<br>          npm run install:all<br>      <br>      - name: Start services<br>        run: |<br>          npm run dev &<br>          sleep 30<br>      <br>      - name: Run E2E tests<br>        run: |<br>          cd frontend<br>          npx cypress run<br></code></pre></p><p><h3>2. Test Scripts</h3></p><p>Add to <code>package.json</code>:<br><pre><code>json<br>{<br>  "scripts": {<br>    "test": "npm run test:frontend && npm run test:backend",<br>    "test:frontend": "cd frontend && npm test -- --watchAll=false",<br>    "test:backend": "cd backend && npm test",<br>    "test:e2e": "cd frontend && npx cypress run",<br>    "test:coverage": "npm run test:frontend -- --coverage && npm run test:backend -- --coverage"<br>  }<br>}<br></code></pre></p><p><h2>Test Data Management</h2></p><p><h3>1. Test Database Setup</h3></p><p><pre><code>javascript<br>// backend/src/__tests__/setup.js<br>const mongoose = require('mongoose');<br>const { MongoMemoryServer } = require('mongodb-memory-server');</p><p>let mongoServer;</p><p>beforeAll(async () => {<br>  mongoServer = await MongoMemoryServer.create();<br>  const mongoUri = mongoServer.getUri();<br>  await mongoose.connect(mongoUri);<br>});</p><p>afterAll(async () => {<br>  await mongoose.disconnect();<br>  await mongoServer.stop();<br>});</p><p>beforeEach(async () => {<br>  // Clean database before each test<br>  const collections = mongoose.connection.collections;<br>  for (const key in collections) {<br>    const collection = collections[key];<br>    await collection.deleteMany({});<br>  }<br>});<br></code></pre></p><p><h3>2. Test Fixtures</h3></p><p><pre><code>javascript<br>// backend/src/__tests__/fixtures.js<br>const Role = require('../models/Role');<br>const User = require('../models/User');</p><p>const createTestRole = async (overrides = {}) => {<br>  const defaultRole = {<br>    name: 'test-role',<br>    description: 'Test role',<br>    permissions: ['user:read'],<br>    ...overrides<br>  };<br>  <br>  return await Role.create(defaultRole);<br>};</p><p>const createTestUser = async (role, overrides = {}) => {<br>  const defaultUser = {<br>    firstName: 'Test',<br>    lastName: 'User',<br>    email: 'test@example.com',<br>    password: 'password123',<br>    role: role._id,<br>    ...overrides<br>  };<br>  <br>  return await User.create(defaultUser);<br>};</p><p>module.exports = {<br>  createTestRole,<br>  createTestUser<br>};<br></code></pre></p><p>This comprehensive testing guide provides all the necessary information to implement a robust testing strategy for the RBAC application, covering unit tests, integration tests, end-to-end tests, security testing, and performance testing.<br></p>
    </div>
</body>
</html>